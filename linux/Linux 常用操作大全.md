# Linux 常用操作大全





## 文件目录相关操作

### 查看操作

#### 文件列表查看操作

- pwd：显示当前的目录名称

  ```shell
  pwd
  ```

- cd：切换当前目录

  - `cd /path/to/...` 绝对路径。
  - `cd ./path/to/...` 相对路径，以当前目录作为起点。
  - `cd ../path/to/...` 相对路径，以上级目录作为起点。
  - `cd -` ：切回到上一个工作目录。

- ls：查看当前目录下的文件

  - `-a`：显示隐藏文件
  - `-t`：按照时间顺序显示
  - `-R`：递归显示
  - `-r`：按文件名倒序显示
  - `-h`：带有单位的显示文件大小

  ```shell
  ls  -alh /home
  ls /root / #同时显示多个目录
  ls -ld /test #只显示一个目录
  ```

#### 文件内容查看操作

- `wc`：统计文件内容信息，`-l`选项可以查看文件有多少行。

  ```shell
  wc -l /tmp/demo
  ```

- `cat`：文本内容显示到终端，一般用于查看文本内容较少的文件。

  ```shell
  cat /root/wy.txt
  ```

- `head`：查看文件开头部分，默认10行。

  ```shell
  head -5 /tmp/wy.txt #显示文件开头前5行记录
  ```

- ==`tail`：查看文件结尾部分，默认最后10行。==

  - `-数字`：查看指定行数的内容，例如，查看文件前10行：

    ```shell
    tail -10 /etc/wy.log
    ```

  - ==`-f`：当文件内容变化的时候，同步进行更新，一般用于观察正被其他程序写入的文件，如日志文件，因此很常用，Ctrl+C退出。==

    ```shell
    tail -f /tmp/my.log
    ```

- more：

- less：



### 创建操作

#### 创建文件

- 创建空白文件：

  ```
  touch /filea.txt
  ```



#### 创建目录

- 使用`-p`选项可以创建多层目录。

  ```shell
  [root@bogon /]# mkdir -p /a/b/c/d/e/f
  [root@bogon /]# ls -R /a  #递归查看多级目录中的文件目录
  ```

  

### 复制操作

无论是复制目录还是文件都使用`cp`命令。

cp命令常用选项：

- `-v`：显示复制过程。
- `-r`：递归复制目录。
- ==`-p`：在复制之后，保留原有文件的时间。==
- `-a`：在复制之后，保留原文件的全部信息，包括权限、所属、文件属性等。

#### 复制文件

```shell
cp -v /root/a.txt /tmp #将a.txt复制到/tmp中
```

#### 复制目录

必须使用`-r`选项。

```shell
cp -r /root/a tmp
```





### 剪切（移动）和重命名

重命名就是所在位置的移动操作。

无论是文件还是目录，都可以使用mv命令完成移动和重命名操作。

```shell
mv /a.txt /b.txt  #将文件a重命名为b.txt
```

处理逻辑：假如能够重命名就执行重命名操作，如果不能就执行移动操作。

例如：`mv /a /c`，表示将/a目录重命名为/c，假如已经存在/c，就表示将/a目录移动到/c目录之下。

例如：`mv /a /c/b2`， 表示重命名为b2，并将目录移动到/c下。

注意：将一个目录复制到某个目录下，一定要确保目标位置所在的父级目录已经存在，否则将变成重命名操作。



### 删除操作

无论是删除文件还是目录，都可以使用rm命令完成操作。

rm命令常用选项：

- `-r`：删除时显示提示。
- `-f`：静默删除，不带删除提示。

删除文件或目录：

```shell
rm -r /a #带有删除提示
rm -rf /a #不带提示的删除目录，谨慎操作
```

如果只是删除空目录，也可以使用rmdir命令。

```
rmdir /a  #只能删除空目录
```



### 打包与解压缩操作

打包、压缩和解压缩操作都可以使用tar命令实现。

常用的选项如下：

- `-c`：创建压缩文件，打包
- `-x `：解开压缩文件，解包

- `-z`：用`Gzip`压缩或解压
- `-j`：用`bzip2`压缩或解压
- `-f`：目标文件名，**该参数必须放在所有参数的最后一位**，代表要压缩或解压的软件包名称。
- `-C`：指定解压到的目录。
- `-v`：显示处理过程。

使用tar命令进行打包与压缩操作，如果不指定压缩方式的话，默认是不压缩的。

例如，将/etc目录打包为指定文件，不采取压缩：

```shell
tar -cf /tmp/etc-backup.tar /etc
```

#### 打包并压缩

`-cf`：打包必须要指定的选项。

例如，打包并使用Gzip压缩，压缩执行快，但压缩率低（压缩后的文件大小比bzip2的要大）

```shell
tar -czf /tmp/etc-backup.tar.gz /etc
```

使用bzip2压缩，压缩率高，但压缩执行时间长。

```shell
tar -cjf /tmp/etc-backup.tar.bz2 /etc
```

#### 解压

`-xf`：解压必须要指定的选项。

`-C`：指定解压后的位置。

将wy.tar.gz压缩包解压到~/app/目录下：

```shell
tar -xzvf wy.tar.gz -C ~/app/
```

 

## 通配符

文件目录相关的操作都可以使用通配符。

复制以“file”开头的文件：

```shell
cp -v file* /
```



## vim

### 普通模式下的常见操作

切换到普通模式：【ESC】

#### 移动光标

- 【h】【j】【k】【`l`】：左、下、上、右，移动光标，推荐使用。
- 方向键，虽然可以但是在个别命令终端，可能会出现乱码，因此不推荐。
- 数字+【G】：将光标定位到指定行。例如，按下数字3，再按下大写的G键，即可将光标定位到第三行。（如果不知道行号，可以在命令模式下设置显示行号，见下文。）
- 【g】：按下小写g，定位光标到第一行。
- 【G】：按下大写G，定位光标到最后一行。
- 【`^`】：定位到光标所在行的开头（类似正则表达式中的开头符），也可以使用【Home】键。
- 【`$`】：定位到光标所在行的结尾。也可以使用【End】键。

#### 复制文本

- 【yy】：复制光标所在整行。如果要复制多行，例如复制3行，使用【3yy】。
- 【y$】：复制光标所在位置到行的结尾。

#### 剪切文本

- 【dd】：剪切光标所在的整行内容。
- 【d$】：剪切光标所在位置到行的结尾。

#### 粘贴文本

- 【p】：粘贴复制的数据。

#### 删除文本

- 【x】：删除光标所在的字符。

#### 替换文本

普通模式下，只能进行简单替换操作，复杂替换需要使用命令模式。

- 【r】：替换光标所在的字符，按下r键，输入新的字符即可。

#### 撤销重做

- 【u】：撤销上一次的操作，可以多次按u键撤销多次。
- 【ctrl+r】：重做上一次的撤销。





### 命令模式下的常见操作

命令模式也称为末行模式，切换到命令模式，需要先切换到普通模式，再从普通模式进入到命令模式。

【ESC】=> 普通模式 => 【;】=> 命令模式。

#### 查找与替换

- `:/`：查找内容，例如，查找“x"：

  ```
  :/x
  ```

  - 【n】：向下查找下一个。
  - 【N】：向上查找上一个。

- `:s/旧/新`：将旧的字符替换为新的字符，==只作用于光标所在行==。例如，将a替换为AA：

  ```shell
  :s/a/AA
  ```

- `n,ms/旧/新/g`：指定行替换，例如在3~5行之间，将所有的"a"替换为“AA”：

  ```shell
  :3,5s/a/AA/g
  ```

  加了/g表示全部替换，不加/g只会单次替换。

- `:%s/旧/新`：将旧的字符替换为新的字符，不需要定位光标，默认只会替换文件中的第一个旧值，如果想要一次性全部替换，需要加上/g命令。例如，将整个文本中的小写“a”全部替换为大写的“AA”，注意需要在末尾加/g，表示一次性全部替换，而不是一个个替换：

  ```
  :%s/a/AA/g
  ```

#### 保存与退出

- `:q`：退出vim编辑器。

- `:w`：保存文件内容。如果没有文件名，可以指定文件名路径。例如：

  ```
  :w /root/a.txt  #保存到/root/a.txt
  ```

- `:wq`：保存并退出。

- `:q!`：不保存退出。

- ==`:!`：临时执行Linux命令==，例如，在打开文件的过程中，想要临时查看一下IP地址，不需要退出vim，只需要执行如下命令：

  ```
  :!ifconfig
  ```

  查看好之后，按下回车，即可回到vim编辑器中。



#### 编辑器设置

- `:set nu`：显示行号
- `:set nonu`：取消行号显示
- `:set nohlsearch`：取消高亮显示。

永久显示行号；

```shell
vim /etc/vimrc
在文件的末尾，添加：
set nu
保存并退出。
```



### 编辑模式下的常见操作

正常模式切换到编辑模式：

- 【`i`】：定位到光标所在位置。
- 【`I`】：定位到光标所在行的开头。
- 【a】：定位到光标所在位置的后面。
- 【A】：定位到光标所在行的结尾。
- 【o】：在光标所在行的下一行插入新行。
- 【O】：在光标所在行的上一行插入新行。



### 可视模式下的常见操作

在可视模式下，可以按照字符、行、块的形式进行选择。

可视模式主要用于大量重复操作，，然后结合【d】和【`I`】键实现删除和写入操作。

正常模式切换到可视模式：

- 【v】：小写v，字符可视模式，以字符为单位进行选择。

- 【V】：大写V，行可视模式，以整行来选择。

- 【ctrl+v】：块可视模式，以上下对齐的块进行选择，类似于VS中的alt+鼠标左键功能。块模式下的常见操作：

  - 在选择的块的每一行前面插入“AA”：

    ```
    ctrl+v，进入到块可视模式，选择块。
    按下大写的i键：【`I`】键，将会定位到块的左上角。
    输入要插入的内容“AA”。
    然后连续按下两次【ESC】即可。
    ```

  - ==【d】：删除选中的块。选中块后，按下【d】键即可，然后`:wq`保存退出。==



## 用户和用户组

创建用户，只有root用户才能创建用户。创建用户wy：

```
useradd wy
```

查看用户所属的组和id信息：

```
id wy
```

普通用户的家目录，在/home/用户名/下。

更改密码，更改其他用户密码时需要指定用户名，更改当前用户密码时，不需要指定用户名：

```shell
passwd wy #更改wy的密码
passwd #更改当前用户的密码
```

删除用户：

```shell
userdel wy #只删除用户，但保留用户数据，如家目录，/etc/passwd中的信息也会保留
userdel -r wy #彻底删除用户即所有数据，不保存用户的家目录
```

修改用户账户：

```shell
usermod -d /home/w1 wy   #修改用户wy的家目录为/home/w1
```

更改用户密码过期时间：

```
chage 
```

新建用户组：

```shell
groupadd group1         #创建一个新的用户组group1
useradd user1			#创建新的用户user1
usermod -g group1 user1 #将用户user1加入到用户组group1中
id user1				#查看用户user1的账户信息
useradd -g group1 user2 #新建用户user2的同时，并加入到用户组group1中
id user2
```

删除用户组：

```shell
groupdel group1 #删除用户组group1
```

切换用户：

- su：切换到某个用户的身份。

  ```shell
  su - user1 #切换到用户user1，减号表示将当前的运行环境一同切换,多用于临时账户的测试
  ```

- sudo：以其他用户的身份执行命令。通常用于将只有管理员才可以执行的命令赋予给一个普通的用户。

- visudo：设置需要使用sudo的用户（组）。

示例，shutdown -c默认情况下，只能root用户可以执行，通过visudo将其赋予给一个新创建的用户，使其也可以通过sudo来执行shutdown -c命令。

- 创建用户并设置密码：

```
useradd user3 #创建用户user3
passwd user3  #为user3创建密码
```

- 输入：visudo，进入到sudo的vim编辑模式。假如将`shutdown -c`命令赋予user3执行sudo操作，可以在文件的末尾添加下述内容：

  ```
  user3 ALL=/sbin/shutdown -c
  ```

  在文件中有大量的示例注释，可以进行参考设置。如果不知道一个命令的位置，可以临时使用which命令。进入到命令模式，输入下述内容，查看shutdown的命令位置：

  ```
  :!which shutdown
  ```

  保存并退出。

- 切换到user3账户，就可以通过sudo命令来执行shutdown -c 命令了。

  ```shell
  sudo /sbin/shutdown -c
  # 提示输入user3的密码，而不是root
  ```



用户管理相关的配置文件：

- /etc/passwd ：用户的配置文件，可以直接编辑该文件来创建和删除用户。
- /etc/shadow：保存用户和用户密码相关信息的文件。
- /etc/group：用户组相关的配置文件。



## 文件权限

### 修改文件、目录权限

chmod命令用来修改权限。

- +：增加权限
- -：移除权限
- =：设置权限
- u：属主权限
- g：属组权限
- o：其他用户权限
- a：全部权限，包括属组、属主和其他用户。
- 数字表示法

```shell
chmod u=rwx wy.txt #设置文件的所有者权限为rwx
chomd g=rwx wy.txt #设置文件的所属组的权限为rwx
chomd o=w wy.txt #设置其他用户只能拥有写的权限
chomd u+x wy.txt #为属主在现有权限的基础上，增加可以执行的权限
chomd g-r wy.txt #为属组在现有权限的基础上，移除可以读取的权限
chomd a+r wy.txt #为属主、属组和其他用户都增加可以读取的权限
chomd 666 wy.txt 
```

特殊权限的修改（不推荐手动修改，保持默认即可）：

```shell
chmod 4755 /test/my.ex  #为文件设置SUID权限，使用数字4开头，加上原有的权限即可
chmod 1777 /test/abc #为目录设置SBIT权限，使用数字1开头，加上原有的权限即可。
```



### 更改属主、属组

chown既可以更改属主也可以更改属组。chgrp只能用来更改属组。

```shell
chown user1 /test #将目录/test的属主改为user1
chown :group1 /test #将目录/test的属组改为group1
chown user1:group1 a.txt #同时更改文件的属主和属组
chgrp user3 /test #将目录/test的属组改为user3，这里使用的是chgrp命令来修改属组
```

- 当一个用户既是属主，同时也属于所在组时，那么属主的权限大于属组的权限。







## 帮助命令

使用man命令，查看man命令的章节。

```
man 7 man
```

查看命令行ls的帮助信息：

```
man 1 ls
```

man命令退出按【Q】键。

查看passwd的全部类型的命令：

```
man -a passwd
```

退出命令行：Ctrl+C。



使用帮助命令步骤：

- 先使用man命令查看，man命令会显示其是内部命令还是外部命令。
- 如果是shell内部命令，就使用help命令查看，例如：`help cd`。
- 外部命令可以使用`--help`，例如：`ls --help`



### 区分内部命令还是外部命令

```shell
[root@bogon ~]# type cd
cd 是 shell 内嵌
[root@bogon ~]# type ls
ls 是 `ls --color=auto' 的别名
```











## 其他

### 图形界面和命令行相互切换

图形界面切换成命令行界面，打开终端，输入：

```
init 3
```

命令行切换会终端：





### 切换用户

```
exit
会退出当前用户界面，输入新的用户名即可
```



### 关机操作

```
init 0
或
shutdown -h now
```









### 将一个文件复制到另一台服务器上

使用scp命令实现文件的发送。

示例一：将当前目录下的sentinel.conf文件，复制到192.168.171.200的/usr/local/redis/目录中：

```shell
scp sentinel.conf root@192.168.171.200:/usr/local/redis/
```

示例二：将远端192.168.73.131的~/dump.db文件，复制到本地当前目录下：

```shell
scp root@192.168.73.131:~/dbdump.db .
```



### 使用rz命令上传本地文件到服务器上

除了使用类似FileZilla这种工具之外，还可以使用rz命令。

使用之前需要进行安装：

```shell
[root@localhost ~]# rz
-bash: rz: 未找到命令
[root@localhost ~]# yum search rz
...
lrzsz.x86_64 : The lrz and lsz modem communications programs
...
[root@localhost ~]# yum install lrzsz
```

安装完成之后，进入到要上传的目标目录，执行rz命令，会弹出文件选中对话框，选中文件之后，将会上传到服务器上的当前目录中。

```shell
[root@localhost ~]# cd /home/software
[root@localhost software]# rz  
```



### 使用 pstree 命令查看进程关系

可以使用如下命令进行安装pstree：

```
yum install psmisc
或
sudo apt-get install psmisc
```

如果想要查看某个进程Id的父级进程信息，可以输入`pstree -halps <pid>`命令来查看。例如：

```shell
[root@bogon ~]# pstree -halps 1901
systemd,1 --switched-root --system --deserialize 22
  └─containerd-shim,1839 -namespace moby -id ff84e2008a4e97f5fc60ac1fb35b9e2a5d5b3bf354c90d95be6480f77ae8719c -address /run/containerd/containerd.sock
      └─nginx,1857
          └─nginx,1901
[root@bogon ~]# 

```





## 杂项

查看已启动的服务列表：systemctl list-unit-files|grep enabled

查看启动失败的服务列表：systemctl --failed

