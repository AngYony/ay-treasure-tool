# Linux计划任务服务程序

计划任务服务程序主要用于在指定的时间段自动启用或停止某些服务或命令，而无需人为的介入，从而实现自动化运维。

计划任务分为两类：

- 单次计划任务，一般用于满足临时的工作需求。例如：指定今天晚上11点30分开启网站服务。
- 多次长期性计划任务，一般用于周期性地、有规律性的执行某些具体的任务。例如：每周一的凌晨3点将`/home/wwwroot`目录打包备份为`backup.tar.gz`。



## 单次计划任务

可以使用`at`命令实现单次计划任务，只需要指定具体时间即可。默认采用的是交互式的形式来设置计划任务。

### 创建单次计划任务

示例一，在20:05分，创建一个文件：

```shell
[root@localhost mail]# at 04:06
at> touch wyang.txt
at> 此处请同时按下Ctrl+d来结束编写计划任务
job 3 at Fri Nov 15 04:06:00 2019
```

### 查看单次计划任务

使用`at -l`命令来查看已设置好但是还未执行的单次计划任务：

```shell
[root@localhost mail]# at -l
1	Sat Nov 16 04:02:00 2019 a root
```

上述显示的结果的开头为当前任务的序号。

### 删除单次计划任务

使用`atrm`命令删除已设置的计划任务，需要指定任务序号。

例如，删除序号为1的单次计划任务：

```shell
[root@localhost mail]# atrm 1
[root@localhost mail]# at -l
无任何结果
```

### 示例

使用管道符，让`at`命令接收前面`echo`命令的输出信息，以达到通过非交互式的方式创建计划一次性任务的目的。

```shell
[root@localhost mail]# echo "echo 'wwwwwww'" | at 04:16
job 4 at Fri Nov 15 04:16:00 2019
```



## 多次长期性计划任务

使用`crond`命令创建周期性地、有规律地多次长期性计划任务。

### 创建、编辑长期性计划任务

使用`crontab -e`命令来创建或编辑计划任务。格式如下：

```
crontab -e
```

一旦执行了上述命令之后，将会进入到编写计划任务格式语句的交互界面。

#### 设置任务的参数格式与说明

设置任务的参数格式如下：

```
分钟 小时 日期 月份 星期 命令
50  3    2   1   *    run_command
```

参数字段说明如下表所示：

| 参数 | 说明                                     |
| ---- | ---------------------------------------- |
| 分钟 | 取值为0～59的整数                        |
| 小时 | 取值为0～23的任意整数                    |
| 日期 | 取值为1～31的任意整数                    |
| 月份 | 取值为1～12的任意整数                    |
| 星期 | 取值为0～7的任意整数，其中0与7均为星期日 |
| 命令 | 要执行的命令或程序脚本                   |

需要注意的是：

- 如果有些参数没有设置，则需要使用星号（`*`）占位。

- 可以使用逗号（`,`）来分别表示多个时间段，例如：日期参数取值为8,9,10，表示8月、9月和10月。

- 可以使用减号（`-`）来表示一段连续的时间周期，例如：日期参数取值为12-15，表示每月12~15日。

- 使用除号（`/`）来表示执行任务的间隔时间，例如：分钟参数取值为“`*/2`”，表示每隔2分钟执行一次任务。

- 如果在crond服务中需要同时包含多条计划任务的命令语句，应每行仅写一条。

- ==命令参数中的命令必须使用绝对路径的方式来写==，如果不知道绝对路径，可以用`whereis`命令进行查询。

  例如，查询`rm`命令路径：

  ```shell
  [root@localhost ~]# whereis rm
  rm: /usr/bin/rm /usr/share/man/man1/rm.1.gz /usr/share/man/man1p/rm.1p.gz
  ```

  `rm`命令路径为：`/usr/bin/rm`。

- 分钟参数必须指定数值，不能为空或指定为星号（`*`）。

- 日期和星期参数不能同时指定值，否则就会发生冲突。

示例一，每周一、三、五的凌晨3点25分，使用`tar`命令，对`/home/root/wy`文件夹进行打包：

```
#可以像shell脚本一样添加注释
25 3 * * 1,3,4 /usr/bin/tar -czvf backup.tar.gz /home/root/wy
```

### 查看长期性计划任务

使用`crontab -l`命令查看当前计划任务。

```shell
[root@localhost ~]# crontab -l
25 3 * * 1,3,4 /usr/bin/tar -czvf backup.tar.gz /home/root/wy
```

### 删除长期性计划任务

使用`crontab -r`命令删除计划任务，该命令实际上删除的是crontab文件，会删除当前用户在crontab中设置的所有计划任务。

```shell
root@localhost ~]# crontab -r
```

如果需要删除单条计划任务，使用`crontab -e`命令手动编辑crontab中的计划任务即可。

### 编辑他人的计划任务

如果是以管理员的身份登录的系统，还可以在`crontab`命令中加上`-u`参数来编辑他人的计划任务。（为自己创建计划任务无需使用`-u`参数）