# 数据切分

数据切分，简单来说，就是根据某种条件，将之前存储在一台数据库上的数据，分散到多台数据库中，从而达到降低单台数据库负载的效果。

数据切分根据其切分的规则，分为两种类型：

- 垂直切分
- 水平切分



## 垂直切分

 对于数据库来说，垂直切分指的是将库中的表切分到其他数据库中，即将不同表落到不同的物理机中的不同数据库中，使其完全隔离，从而达到降低数据库负载的效果。

对于单个表来说，垂直切分指的是将一个表中的多个列，按照业务规则，进行拆分，实质就是拆列。

优点：

- 拆分后业务清晰，拆分规则明确；
- 系统之间容易扩展和整合；
- 数据维护简单。

缺点：

- 不同业务的数据库中的表无法join，只能通过接口调用，提升了系统复杂度；
- 跨库后，事务难以处理；
- 即使是垂直切分，如果某些业务数据过于庞大，依然存在单体性能瓶颈。



## 水平切分

水平切分指的是将一个表中的数据，根据某种规则拆分到不同的数据库中。

水平拆分的常见拆分规则：

- 用户id求模运算；
- 按照日期去拆分数据；
- 按照其他字段求模去拆分数据；

优点：

- 解决了单库大数据、高并发的性能瓶颈；
- 拆分规则封装好，对应用端几乎透明，开发人员无需关心拆分细节；
- 提高了系统的稳定性和负载能力；

缺点：

- 拆分规则很难抽象；
- 分片事务一致性难以解决；
- 二次扩展时，数据迁移、维护难度大。比如：开始我们按照用户id对2求模，但是随着业务的增长，2台数据库难以支撑，还是继续拆分成4个数据库，那么这时就需要做数据迁移了。



## 总结

无论水平切分还是垂直切分，都有共同缺点：

- 分布式的事务问题；
- 跨库join问题；
- 多数据源的管理问题。

针对多数据源的管理问题，主要有两种思路：

- 客户端模式，在每个应用模块内，配置自己需要的数据源，直接访问数据库，在各模块内完成数据的整合。可用组件：sharding-jdbc
- 中间代理模式，中间代理统一管理所有的数据源，数据库层对开发人员完全透明，开发人员无需关注拆分的细节。可用组件：MyCat



